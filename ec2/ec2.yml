---
  - hosts: 
      - localhost
    connection: local
    vars_files:
      - ./vars.yml
    tasks:
      - name: "create VPC"
        ec2_vpc_net:
          name: "VPC-{{ PREFIX }}"
          cidr_block: "{{ VPC_ADDR }}"
          region: "{{ REGION }}"
        register: _vpc
      - name: Internet gateway
        ec2_vpc_igw:
          vpc_id: "{{ _vpc.vpc.id }}"
          region: "{{ REGION }}"
        register: _igw
      - name: "Public subnet a"
        ec2_vpc_subnet:
          vpc_id: "{{ _vpc.vpc.id }}"
          az: "{{ REGION }}a"
          cidr: "{{ SUBNET_A_ADDR }}"
          resource_tags:
            Name: "SUBNET-A-{{ PREFIX }}"
          region: "{{ REGION }}"
        register: _subnet_a
      - name: "Public subnet c"
        ec2_vpc_subnet:
          vpc_id: "{{ _vpc.vpc.id }}"
          az: "{{ REGION }}c"
          cidr: "{{ SUBNET_C_ADDR }}"
          resource_tags:
            Name: "SUBNET-C-{{ PREFIX }}"
          region: "{{ REGION }}"
        register: _subnet_c
      - name: "Route"
        ec2_vpc_route_table:
          vpc_id: "{{ _vpc.vpc.id }}"
          tags:
            Name: "RT-{{ PREFIX }}"
          subnets:
            - "{{ _subnet_a.subnet.id }}"
            - "{{ _subnet_c.subnet.id }}"
          routes:
            - dest: 0.0.0.0/0
          gateway_id: "{{ _igw.gateway_id  }}"
          region: "{{ REGION }}"
        register: _route