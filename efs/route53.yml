---
  - hosts: dbserver
    connection: local
    tasks:
      - name: "get vpcid"
        ec2_vpc_net_facts:
          region: "{{ REGION }}"
          filters:
            "tag:Name": "{{ PREFIX }}-VPC"
        register: vpc_facts
        run_once: true
        tags:
          - create
          - delete

      - name: "delete private zone"
        route53_zone:
          zone: "{{ DOMAIN_NAME }}"
          region: "{{ REGION }}"
          state: absent
          vpc_id: "{{ vpc_facts['vpcs'][0]['id'] }}"
          comment: "{{ PREFIX }}"
        run_once: true
        tags:
          - delete
          - create

      - name: "create private zone"
        route53_zone:
          zone: "{{ DOMAIN_NAME }}"
          region: "{{ REGION }}"
          state: present
          vpc_id: "{{ vpc_facts['vpcs'][0]['id'] }}"
          vpc_region: "{{ REGION }}"
          comment: "{{ PREFIX }}"
        run_once: true
        tags:
          - create

          
      - name: "create record"
        route53:
          command: create
          zone: "{{ DOMAIN_NAME }}"
#          region: "{{ REGION }}"
          record:  "{{ SCAN_NAME }}.{{ DOMAIN_NAME }}"
          type: A
          ttl: 300
          value:
            - "{{ scan0_IP }}"
            - "{{ scan1_IP }}"
            - "{{ scan2_IP }}"
          wait: yes
          vpc_id: "{{ vpc_facts['vpcs'][0]['id'] }}"
          private_zone: yes
        run_once: true
        tags:
          - create
                     
      - name: "record host dns"
        route53:
          command: create
          zone: "{{ DOMAIN_NAME }}"
          region: "{{ REGION }}"
          type: A
          value: "{{ vxlan0_IP }}"
          overwrite: yes
          record: "{{ NODENAME }}.{{ DOMAIN_NAME }}"
          ttl: 300
          wait: yes
          vpc_id: "{{ vpc_facts['vpcs'][0]['id'] }}"
          private_zone: yes
        tags:
          - create
          
