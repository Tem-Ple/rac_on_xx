---
  - name: "disable selinux"
    become: yes
    replace: dest='/etc/selinux/config' regexp='SELINUX=enforcing' replace='SELINUX=disabled'
    tags:
      - security

  - name: "disable selinux setenforce"
    become: yes
    shell: setenforce 0
    ignore_errors: yes
    tags:
      - security

  - name: "disable firewalld"
    become: yes
    service: name=firewalld.service state=stopped enabled=no


  - name: "create group"
    become: yes
    group: name={{ item.name }} state=present gid={{ item.gid }}
    with_items:
      - { name: 'oinstall', gid: '601' }
      - { name: 'dba', gid: '602' }
      - { name: 'oper', gid: '603' }
      - { name: 'asmadmin', gid: '2001' }
      - { name: 'asmdba', gid: '2002' }
      - { name: 'asmoper', gid: '2003' }
    tags:
      - createuser

  - name: "delete user"
    become: yes
    user: name={{ item }} state=absent remove=yes
    with_items:
      - oracle
      - grid
    tags:
      - createuser

  - name: "create user"
    become: yes
    user: name={{ item.name}} uid={{ item.uid }} group=oinstall groups={{ item.groups}} shell=/bin/bash
    with_items:
      - { name: 'oracle', uid: '501',groups: 'dba,oper,asmdba' }
      - { name: 'grid', uid: '2001',groups: 'asmadmin,asmdba,asmoper' }
    tags:
      - createuser

  - name: "copy .bashrc"
    become: yes
    copy: src=.bashrc dest=/home/{{ item }}/.bashrc mode=644 owner={{ item }} group=oinstall 
    with_items:
      - oracle
      - grid
    tags:
      - createuser

  - name: "copy .bash_profile"
    become: yes
    template: src=.bash_profile_{{ item }}.j2 dest=/home/{{ item }}/.bash_profile mode=0644 owner={{ item }} group=oinstall
    with_items:
      - oracle
      - grid
    tags:
      - createuser
      
  - name: "create ssh key"
    local_action: shell ssh-keygen -t rsa -P "" -f id_rsa
    args:
      creates: id_rsa
    run_once: true
    tags:
      - sshkey
 
  - name: "copy authorized key"
    become: yes
    authorized_key: user={{ item }} key="{{ lookup('file', 'id_rsa.pub') }}" 
    with_items:
      - oracle
      - grid
    tags:
      - sshkey

  - name: "copy private key"
    become: yes
    copy: dest=/home/{{ item }}/.ssh/id_rsa mode=600 owner={{ item }} group=oinstall content="{{ lookup('file', 'id_rsa') }}"
    with_items:
      - oracle
      - grid
    tags:
      - sshkey

  - name: "create known hosts"
    become: yes
    template: src=known_hosts.j2 dest=/home/{{ item }}/.ssh/known_hosts owner={{ item }} group=oinstall mode=0644
    with_items:
      - oracle
      - grid
    tags:
      - sshkey

  - name: "copy limits.nonf"
    become: yes
    copy: src=limits.conf dest=/etc/security/limits.conf mode=644 owner=root group=root
    tags:
      - kernel
