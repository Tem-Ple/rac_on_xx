---
  - name: "install dnsmasq packages"
    become: yes
    yum: name=dnsmasq state=present
    tags:
      - dnsmasq

  - name: "create addn-hosts"
    become: yes
    template: src=addn-hosts.j2 dest=/etc/addn-hosts owner=root group=root mode=0644
    tags:
      - dnsmasq

  - name: "copy dnsmasq.conf"
    become: yes
    copy: src=dnsmasq.conf dest=/etc/dnsmasq.conf owner=root group=root mode=0644
    tags:
      - dnsmasq

  - name: "copy resolv.dnsmasq.conf from /etc/resolv.conf"
    become: yes
    #copy: src=resolv.dnsmasq.conf dest=/etc/resolv.dnsmasq.conf owner=root group=root mode=0644
    shell: cp /etc/resolv.conf /etc/resolv.dnsmasq.conf
      creates=/etc/resolv.dnsmasq.conf
    tags:
      - dnsmasq
      
  - name: "start enable dnsmasq"
    become: yes
    service: name=dnsmasq.service state=restarted enabled=yes
    tags:
      - dnsmasq

  - name: "create sethosts"
    become: yes
    template: src=30_hostname.j2 dest=/etc/NetworkManager/dispatcher.d/30_hostname owner=root group=root mode=0700
    tags:
      - hostname

  - name: "change hostname"
    become: yes
    shell: bash /etc/NetworkManager/dispatcher.d/30_hostname vxlan0 up
    tags:
      - hostname

  - name: "create setresolvconf"
    become: yes
    template: src=31_resolvconf.j2 dest=/etc/NetworkManager/dispatcher.d/31_resolvconf owner=root group=root mode=0700
    tags:
      - resolvconf

  - name: "change resolvconf"
    become: yes
    shell: bash /etc/NetworkManager/dispatcher.d/31_resolvconf vxlan0 up
    tags:
      - resolvconf

  - name: "start_enable nm_dispacher"
    become: yes
    service: name=NetworkManager-dispatcher.service state=restarted enabled=yes
    tags:
      - hostname
      - resolvconf
